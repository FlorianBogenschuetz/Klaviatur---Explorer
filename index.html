import React, { useState } from 'react';
import { Music, Info } from 'lucide-react';

const PianoChordExplorer = () => {
  const [selectedChord, setSelectedChord] = useState('E');
  const [showTheory, setShowTheory] = useState(true);

  // Akkord-Definitionen
  const chords = {
    'E': { name: 'E-Dur', notes: ['E', 'G#', 'H'], color: 'bg-blue-400' },
    'A': { name: 'A-Dur', notes: ['A', 'C#', 'E'], color: 'bg-green-400' },
    'H': { name: 'H-Dur', notes: ['H', 'D#', 'F#'], color: 'bg-purple-400' },
    'C#m': { name: 'C#-Moll', notes: ['C#', 'E', 'G#'], color: 'bg-red-400' },
    'F#m': { name: 'F#-Moll', notes: ['F#', 'A', 'C#'], color: 'bg-yellow-400' },
    'G#m': { name: 'G#-Moll', notes: ['G#', 'H', 'D#'], color: 'bg-pink-400' },
    'D': { name: 'D-Dur', notes: ['D', 'F#', 'A'], color: 'bg-indigo-400' },
    'Am': { name: 'A-Moll', notes: ['A', 'C', 'E'], color: 'bg-orange-400' }
  };

  const isNoteInChord = (note) => {
    const chordNotes = chords[selectedChord].notes;
    return chordNotes.includes(note);
  };

  // Eine Oktave mit korrekter schwarzer Tasten-Platzierung
  const renderOctave = (octaveNum) => {
    const whiteNotes = ['C', 'D', 'E', 'F', 'G', 'A', 'H'];
    // Schwarze Tasten: zwischen C-D, D-E, F-G, G-A, A-H
    const blackNotes = [
      { note: 'C#', position: 0 },  // zwischen C und D
      { note: 'D#', position: 1 },  // zwischen D und E
      { note: 'F#', position: 3 },  // zwischen F und G
      { note: 'G#', position: 4 },  // zwischen G und A
      { note: 'A#', position: 5 }   // zwischen A und H
    ];

    return (
      <div key={octaveNum} className="relative inline-block">
        {/* Wei√üe Tasten */}
        <div className="flex">
          {whiteNotes.map((note, idx) => {
            const isActive = isNoteInChord(note);
            return (
              <div
                key={`white-${octaveNum}-${note}-${idx}`}
                className={`relative w-14 h-44 border-2 border-gray-800 ${
                  isActive ? chords[selectedChord].color : 'bg-white'
                } transition-all duration-300`}
              >
                <div className="absolute bottom-3 left-0 right-0 text-center text-sm font-semibold text-gray-700">
                  {note}
                  {isActive && <div className="text-2xl mt-1">‚óè</div>}
                </div>
              </div>
            );
          })}
        </div>

        {/* Schwarze Tasten */}
        {blackNotes.map(({ note, position }) => {
          const isActive = isNoteInChord(note);
          // Position berechnen: jede wei√üe Taste ist 56px breit (w-14)
          const leftOffset = position * 56 + 56 - 20; // 56px pro Taste, minus halbe Breite der schwarzen Taste
          
          return (
            <div
              key={`black-${octaveNum}-${note}`}
              className={`absolute top-0 w-10 h-28 border-2 border-gray-900 ${
                isActive ? chords[selectedChord].color : 'bg-gray-900'
              } transition-all duration-300 rounded-b-sm`}
              style={{ left: `${leftOffset}px` }}
            >
              <div className="absolute bottom-2 left-0 right-0 text-center text-xs font-semibold text-white">
                {note.replace('#', '‚ôØ')}
                {isActive && <div className="text-lg mt-1">‚óè</div>}
              </div>
            </div>
          );
        })}
      </div>
    );
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-100 to-slate-200 p-8">
      <div className="max-w-6xl mx-auto">
        {/* Header */}
        <div className="text-center mb-8">
          <div className="flex items-center justify-center gap-3 mb-4">
            <Music className="w-10 h-10 text-blue-600" />
            <h1 className="text-4xl font-bold text-gray-800">Klaviatur-Explorer</h1>
          </div>
          <p className="text-gray-600">Lerne Akkorde und ihre Struktur auf der Klaviertastatur</p>
        </div>

        {/* Akkord-Auswahl */}
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">Akkord w√§hlen:</h2>
          <div className="grid grid-cols-4 gap-3">
            {Object.keys(chords).map((chord) => (
              <button
                key={chord}
                onClick={() => setSelectedChord(chord)}
                className={`py-3 px-4 rounded-lg font-semibold transition-all ${
                  selectedChord === chord
                    ? 'bg-blue-600 text-white shadow-lg scale-105'
                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`}
              >
                {chords[chord].name}
              </button>
            ))}
          </div>

          {/* Aktueller Akkord Info */}
          <div className="mt-6 p-4 bg-blue-50 rounded-lg">
            <h3 className="text-xl font-bold text-gray-800 mb-2">
              {chords[selectedChord].name}
            </h3>
            <p className="text-gray-700">
              <span className="font-semibold">T√∂ne:</span>{' '}
              {chords[selectedChord].notes.join(' - ')}
            </p>
          </div>
        </div>

        {/* Klaviatur */}
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6 overflow-x-auto">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">Klaviatur (2 Oktaven):</h2>
          <div className="flex justify-center">
            {[0, 1].map(octave => renderOctave(octave))}
          </div>
          <p className="text-center text-gray-600 mt-6 text-sm">
            ‚óè = T√∂ne des gew√§hlten Akkords
          </p>
        </div>

        {/* Theorie-Bereich */}
        <div className="bg-white rounded-lg shadow-lg p-6">
          <button
            onClick={() => setShowTheory(!showTheory)}
            className="flex items-center gap-2 text-2xl font-bold text-gray-800 mb-4 hover:text-blue-600 transition-colors w-full"
          >
            <Info className="w-6 h-6" />
            Akkordtheorie
            <span className="text-sm ml-2">{showTheory ? '‚ñº' : '‚ñ∂'}</span>
          </button>

          {showTheory && (
            <div className="space-y-6 text-gray-700">
              <div>
                <h3 className="text-xl font-semibold mb-2 text-gray-800">Was ist ein Akkord?</h3>
                <p>Ein Akkord besteht aus mindestens drei T√∂nen, die gleichzeitig gespielt werden. Die h√§ufigsten Akkorde sind Dreikl√§nge (drei T√∂ne).</p>
              </div>

              <div>
                <h3 className="text-xl font-semibold mb-2 text-gray-800">Dur-Akkorde</h3>
                <p className="mb-2">Dur-Akkorde klingen hell und fr√∂hlich. Sie bestehen aus:</p>
                <ul className="list-disc list-inside space-y-1 ml-4">
                  <li><span className="font-semibold">Grundton</span> - der namensgebende Ton</li>
                  <li><span className="font-semibold">Gro√üe Terz</span> - 4 Halbt√∂ne √ºber dem Grundton</li>
                  <li><span className="font-semibold">Quinte</span> - 7 Halbt√∂ne √ºber dem Grundton</li>
                </ul>
                <p className="mt-2 italic">Beispiel E-Dur: E (Grundton) + G‚ôØ (gro√üe Terz) + H (Quinte)</p>
              </div>

              <div>
                <h3 className="text-xl font-semibold mb-2 text-gray-800">Moll-Akkorde</h3>
                <p className="mb-2">Moll-Akkorde klingen dunkler und melancholischer. Sie bestehen aus:</p>
                <ul className="list-disc list-inside space-y-1 ml-4">
                  <li><span className="font-semibold">Grundton</span> - der namensgebende Ton</li>
                  <li><span className="font-semibold">Kleine Terz</span> - 3 Halbt√∂ne √ºber dem Grundton</li>
                  <li><span className="font-semibold">Quinte</span> - 7 Halbt√∂ne √ºber dem Grundton</li>
                </ul>
                <p className="mt-2 italic">Beispiel C‚ôØ-Moll: C‚ôØ (Grundton) + E (kleine Terz) + G‚ôØ (Quinte)</p>
              </div>

              <div>
                <h3 className="text-xl font-semibold mb-2 text-gray-800">Das Klavier-Layout verstehen</h3>
                <p className="mb-2">Das Muster der schwarzen Tasten wiederholt sich in jeder Oktave:</p>
                <ul className="list-disc list-inside space-y-1 ml-4">
                  <li>Zwischen C-D und D-E gibt es schwarze Tasten (C‚ôØ und D‚ôØ)</li>
                  <li>Zwischen E-F gibt es KEINE schwarze Taste</li>
                  <li>Zwischen F-G, G-A und A-H gibt es schwarze Tasten (F‚ôØ, G‚ôØ und A‚ôØ)</li>
                  <li>Zwischen H-C gibt es KEINE schwarze Taste</li>
                </ul>
                <p className="mt-2">Dieses Muster hilft dir, dich auf der Tastatur zu orientieren!</p>
              </div>

              <div>
                <h3 className="text-xl font-semibold mb-2 text-gray-800">√úbungstipps</h3>
                <ul className="list-disc list-inside space-y-1 ml-4">
                  <li>√úbe jeden Akkord einzeln, bis du ihn sicher greifen kannst</li>
                  <li>Spiele die T√∂ne erst einzeln (Arpeggio), dann zusammen</li>
                  <li>Wechsle langsam zwischen verschiedenen Akkorden</li>
                  <li>Achte auf eine entspannte Handhaltung</li>
                  <li>√úbe Akkorde in verschiedenen Oktaven</li>
                </ul>
              </div>

              <div className="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400">
                <h3 className="text-lg font-semibold mb-2 text-gray-800">üí° F√ºr "Mariage d'Amour":</h3>
                <p>Das St√ºck steht in E-Dur und verwendet haupts√§chlich die hier gezeigten Akkorde. Um das St√ºck zu lernen, besorge dir die offiziellen Noten oder nutze YouTube-Tutorials, die die Akkordfolge Schritt f√ºr Schritt zeigen.</p>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default PianoChordExplorer;
